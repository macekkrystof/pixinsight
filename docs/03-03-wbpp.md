---
title: "PixInsight pro úplné začátečníky #3 – stackování WBPP"
---

Snímky máme roztříděné do čtyř složek: Light, Dark, Flat, Bias. Pokud nefotíte Bias snímky, ale DarkFlat, pojmenujte složku třeba `DarkFlat`. Teď otevřeme PixInsight a spustíme skript Scripts → Batch Processing → WeightedBatchPreProcessing (WBPP).

![](./03-03-wbpp/03-03-wbpp_img01_image-15.png)
Máte‑li data pěkně rozřazená, můžete v levém dolním rohu okna kliknout na **+ Directory** a vybrat složku s daty. **Důležité je, aby v ní byly jen podsložky s daty a žádné další soubory.** Pokud skript správně rozpozná všechny snímky, karta Calibration bude vypadat zhruba takto:

![](./03-03-wbpp/03-03-wbpp_img02_image-17.png)
Pokud se rozpoznání nezdařilo, vyresetujte seznam tlačítkem Reset ve spodní části okna a přidejte snímky ručně tlačítky +Bias, +Darks, +Flats, +Lights. Pokud nemáte Bias snímky, ale DarkFlat, přidejte je jako Dark – skript je správně přiřadí díky shodné délce expozice s flaty.

V kartách Bias, Darks a Flats obvykle není nutné nic měnit. Přesuneme se rovnou do karty Lights.

## Lights

![](./03-03-wbpp/03-03-wbpp_img03_image-18.png)
Zkontrolujte, že máte v pravém panelu zaškrtnuté všechny procesy od Subframe Weighting po Image Integration.

### Astrometric solution

V sekci Astrometric Solution klikněte na Image Solver parameters… a zkontrolujte, že jsou pole vyplněna správně. PixInsight během stackování analyzuje snímky a provádí „plate solving“, takže potřebuje správné souřadnice objektu, ohniskovou vzdálenost, velikost pixelů a datum (čas nemusí být přesný).

Pokud používáte software pro snímání DSO (ASIAir, KStars, N.I.N.A…), bývají tyto údaje v hlavičce FITS. Přesto je zkontrolujte – PixInsight si někdy pamatuje hodnoty z minulého zpracování. Pokud plate solving během stackování selže, PixInsight vás vyzve k zadání údajů znovu.

Souřadnice objektu můžete najít pomocí tlačítka Search. Do otevřeného okna zadáte název (kód objektu) a PixInsight je vyhledá v online katalogu.

![](./03-03-wbpp/03-03-wbpp_img04_image-21.png)
Takto vypadá finální zadání pro data mlhoviny M42.

![](./03-03-wbpp/03-03-wbpp_img05_image-23.png)

### Image Integration

V Image Integration zaškrtněte **Large-scale pixel rejection**. Vývojáři to doporučují kvůli množství satelitních stop (Starlink apod.). Výsledek bývá čistší.

![](./03-03-wbpp/03-03-wbpp_img06_image-24.png)

## Calibration

Přejděte do karty Calibration.

![](./03-03-wbpp/03-03-wbpp_img07_image-25.png)
Tady většinou nic měnit nemusíte. Zkontrolujte, že všechny načtené snímky sedí. U Light snímků v pravém panelu ověřte, že je zaškrtnuté **CFA images**, pokud jsou snímky barevné. Pokud jsou mono, CFA zaškrtnuté být nesmí.

Pokud máte barevné lighty a musíte CFA zatrhnout ručně, vyberte rovnou i správný Mosaic pattern podle Bayerovy masky vaší kamery.

![](./03-03-wbpp/03-03-wbpp_img08_image.png)
Pokud PixInsight barevný obrázek nerozpoznal, pravděpodobně neurčil správně ani Bayerovu masku. S tímto problémem jsem se setkal například u starších kamer Moravian Instruments.

### Output directory

Vyberte výstupní složku (Output directory), kam bude WBPP ukládat průběžná data i výsledný snímek. Zvolte ji podle vlastních preferencí, ale jinou než složku se vstupními daty.

![](./03-03-wbpp/03-03-wbpp_img09_image-1.png)

## Post-Calibration

Poslední karta obsahuje tabulku s výslednými snímky. V našem případě tam bude jen jeden. Někdy jich ale může být více – například když skládáte jednotlivé kanály u mono kamery.

![](./03-03-wbpp/03-03-wbpp_img10_post-calibr.png)
Vyberte jediný řádek v tabulce a podívejte se na pravý panel.

### Drizzle

Drizzle může být zásadní pro vytěžení maxima detailů. Funguje tak, že kombinuje více snímků s malým posunem a rekonstruuje jemné detaily, které by jinak zanikly kvůli limitovanému rozlišení. Výsledkem je vyšší ostrost a nižší šum.

Má to ale podmínky:

- **Používáte dithering?** Dithering je cílené náhodné posouvání snímků mezi expozicemi. Bez něj Drizzle použít nelze. Pokud používáte autoguiding a dithering máte zapnutý, je to v pořádku. U chytrých teleskopů (Seestar a podobné) na AZ montážích není sledování tak přesné a dithering nahrazuje, u nich tedy může být odpověď Ano.
- **Máte alespoň 20 light snímků?** S menším počtem to PixInsight nedoporučuje.
- **Jsou snímky „under‑sampled“?** To nastává, když jsou pixely kamery příliš velké vůči ohnisku a seeingu, a detaily se ztrácí. Spočítat si to můžete [zde]([https://astronomy.tools/calculators/ccd_suitability](https://macekkrystof.github.io/Sampling-calculator/) "zde").
- **Máte zhruba dvojnásobek času na stackování?** Drizzle prodlužuje běh WBPP zhruba 2×. Pokud chcete jen rychlý náhled, nechte ho vypnutý.

Základní nastavení Drizzle může vypadat takto:

![](./03-03-wbpp/03-03-wbpp_img11_image-2.png)
Scale 2 znamená, že výsledný snímek bude mít 2× menší pixely. Vyšší scale jsem zatím nepoužil.

## Spuštění

Vše je nastavené. V pravém dolním rohu klikněte na **Run** a počkejte na dokončení. Doba zpracování závisí na množství dat, velikosti snímků a výkonu počítače – může jít o 15 minut i mnoho hodin. U vzorových dat by moderní PC mělo zvládnout zhruba hodinu.

Problémy při stackování jsou spíše výjimečné. Nejčastěji selže automatický plate solve – pak budete muset ručně zadat souřadnice, datum, ohnisko a velikost pixelů, stejně jako v sekci Astrometric solution.

## Závěr a výsledky

Po dokončení se podívejte do výstupní složky. Struktura bude zhruba takto:

![](./03-03-wbpp/03-03-wbpp_img12_image-3.png)

Nejdůležitější jsou soubory ve složce `master`:

![](./03-03-wbpp/03-03-wbpp_img13_image-4.png)
Soubor *masterLight_BIN-1_3008x3008_EXPOSURE-180.00s_FILTER-NoFilter_RGB_autocrop.xisf* je složený snímek, který byl zároveň ořezán do společné oblasti (kvůli ditheringu a mírným posunům mezi snímky).

Soubor *masterLight_BIN-1_3008x3008_EXPOSURE-180.00s_FILTER-NoFilter_RGB_drizzle_2x_autocrop.xisf* je obdobný, ale s použitím Drizzle a bude větší.

Struktura názvů je vždy stejná, lišit se budou pouze hodnoty binningu, rozlišení a expozice. Výsledný snímek tak snadno najdete i u vlastních dat. Zkuste si ho otevřít a v příštím díle se pustíme do dalšího zpracování.
